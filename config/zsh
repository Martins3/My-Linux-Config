eval "$(zoxide init zsh)"

export ATUIN_NOBIND="true"
eval "$(atuin init zsh)"

bindkey '^r' _atuin_search_widget
# eval "$(atuin init zsh --disable-up-arrow)"
# eval "$(mcfly init zsh)"
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=5'
export PATH="$HOME/.npm-packages/bin:$PATH"
export PATH="$HOME/.cargo/bin:$PATH"

source /etc/os-release
if [[ $ID == "nixos" ]];then
  eval "$(direnv hook zsh)"

  function en_direnv() {
    echo "use nix" >> .envrc && direnv allow
  }

  export NIX_CONF_DIR=$HOME/.config/nixpkgs/nix
fi
eval "$(starship init zsh)"


function rpm_extract() {
  rpm2cpio $1 | cpio -idmv
}

function px() {
  PROXY_SERVER_IP="http://127.0.0.1"
  PROXY_SERVER_PORT=8889
  while getopts "ga:p:hu" opt; do
    case $opt in
      g)
        PROXY_SERVER_IP="http://10.0.2.2"
        PROXY_SERVER_PORT=8889
        ;;
      a)
        PROXY_SERVER_IP=${OPTARG}
        ;;
      p)
        PROXY_SERVER_PORT=${OPTARG}
        ;;
      u)
        export https_proxy=
        export http_proxy=
        export HTTPS_PROXY=
        export HTTP_PROXY=
        export ftp_proxy=
        export FTP_PROXY=

        return
        ;;
      h)
        echo "-g : use this in QEMU"
        echo "-a : ip address"
        echo "-p : ip port"
        ;;
      *)
        exit 1
        ;;
    esac # --- end of case ---
  done

  export https_proxy="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
  export http_proxy="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
  export HTTPS_PROXY="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
  export HTTP_PROXY="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
  export ftp_proxy="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
  export FTP_PROXY="$PROXY_SERVER_IP:$PROXY_SERVER_PORT"
}

function vfio_nvme(){
  echo 0000:03:00.0 | sudo tee /sys/bus/pci/devices/0000:03:00.0/driver/unbind
  echo 1e49 0071 | sudo tee /sys/bus/pci/drivers/vfio-pci/new_id
  sudo chown martins3 /dev/vfio/17
}

# 快速打开 QEMU
alias dk="/home/martins3/.dotfiles/scripts/qemu/launch.sh -d"
alias rk=/home/martins3/core/vn/docs/qemu/sh/alpine.sh
alias k=/home/martins3/.dotfiles/scripts/qemu/launch.sh
alias kk="/home/martins3/.dotfiles/scripts/qemu/launch.sh -k"
alias ge="ssh -p5556 root@localhost"
alias nk="nix-shell '<nixpkgs>' -A linuxPackages_latest.kernel --command zsh"

alias b="tmuxp load -d $HOME/.dotfiles/config/tmux-session.yaml"
alias c="clear"
alias f="/home/martins3/core/vn/docs/kernel/flamegraph/flamegraph.sh"
alias ck="/home/martins3/.dotfiles/config/sh/compile-kernel.sh"
alias cq="/home/martins3/.dotfiles/config/sh/compile-qemu.sh"
alias du="ncdu"
alias flamegraph="/home/martins3/core/vn/docs/kernel/code/flamegraph.sh"
alias git_ignore="echo \$(git status --porcelain | grep '^??' | cut -c4-) > .gitignore"
alias gs="tig status"
alias win="/home/martins3/core/vn/docs/qemu/sh/windows.sh"
alias kernel_version="git describe --contains"
# https://unix.stackexchange.com/questions/45120/given-a-git-commit-hash-how-to-find-out-which-kernel-release-contains-it
alias knews="/home/martins3/.dotfiles/scripts/systemd/news.sh kernel"
alias ldc="lazydocker"
alias ls="exa --icons"
alias m="nice -n 19 make -j$(($(getconf _NPROCESSORS_ONLN) - 1))"
alias mc="make clean"
alias q="exit"
alias qnews="/home/martins3/.dotfiles/scripts/systemd/news.sh qemu"
alias v="nvim"
alias ag=rg
# alias cp=xcp
alias he="nvim +10000  /home/martins3/.dotfiles/nushell/sheet.yaml"
alias kvm_stat="sudo /home/martins3/core/linux/tools/kvm/kvm_stat/kvm_stat"
alias p="python -m venv .venv && source .venv/bin/activate"
alias i="ipython"
alias t="/home/martins3/.dotfiles/config/sh/t.sh"
alias gscp="/home/martins3/.dotfiles/config/sh/gscp.sh"
alias static="nix-shell -p gcc glibc.static --command zsh"
